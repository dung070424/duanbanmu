<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="page-header d-flex justify-content-between align-items-center mb-3">
        <h2>Quản lý màu sắc</h2>
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="bi bi-plus-circle"></i>
          Thêm màu mới
        </button>
      </div>

      <!-- Bộ lọc -->
      <div class="filter-section mb-3">
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label>Tìm kiếm:</label>
              <input
                type="text"
                class="form-control"
                placeholder="Tìm theo tên hoặc mã màu..."
                [(ngModel)]="searchTerm"
                (input)="onSearchChange()"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Bảng màu sắc -->
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th
                class="text-start fw-semibold"
                (click)="setSort('tenMau')"
                style="cursor: pointer"
              >
                Tên màu {{ getSortSymbol('tenMau') }}
              </th>
              <th class="text-start fw-semibold" (click)="setSort('maMau')" style="cursor: pointer">
                Mã màu {{ getSortSymbol('maMau') }}
              </th>
              <th
                class="text-start fw-semibold"
                (click)="setSort('trangThai')"
                style="cursor: pointer"
              >
                Trạng thái {{ getSortSymbol('trangThai') }}
              </th>
              <th class="text-start fw-semibold">Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of filtered">
              <td>
                <span class="manufacturer-name">{{ c.name }}</span>
              </td>
              <td>
                <span class="color-chip" [style.background]="c.code"></span>
                {{ c.code || '-' }}
              </td>
              <td>
                <span class="badge" [class]="c.status ? 'bg-success' : 'bg-secondary'">
                  {{ c.status ? 'Đang hoạt động' : 'Ngừng' }}
                </span>
              </td>
              <td>
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-sm btn-outline-info"
                    (click)="viewColor(c)"
                    title="Xem chi tiết"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                  <button
                    class="btn btn-sm btn-outline-warning"
                    (click)="openEditModal(c)"
                    title="Chỉnh sửa"
                  >
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="delete(c)" title="Xóa">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination controls -->
      <div class="d-flex align-items-center justify-content-between mt-2">
        <div>
          <button
            class="btn btn-sm btn-outline-secondary me-2"
            (click)="prevPage()"
            [disabled]="currentPage === 0"
          >
            Trang trước
          </button>
          <button
            class="btn btn-sm btn-outline-secondary"
            (click)="nextPage()"
            [disabled]="currentPage >= totalPages - 1"
          >
            Trang sau
          </button>
        </div>
        <div>
          <span class="me-2">Trang {{ currentPage + 1 }}/{{ totalPages }}</span>
          <select
            class="form-select form-select-sm d-inline-block w-auto"
            [ngModel]="pageSize"
            (ngModelChange)="changePageSize($event)"
          >
            <option [ngValue]="5">5</option>
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
          </select>
        </div>
      </div>

      <!-- Thông báo khi không có dữ liệu -->
      <div *ngIf="filtered.length === 0" class="text-center py-5">
        <i class="bi bi-palette display-1 text-muted"></i>
        <h4 class="text-muted mt-3">Không tìm thấy màu sắc nào</h4>
        <p class="text-muted">Hãy thử thay đổi bộ lọc hoặc thêm màu mới</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal thêm/sửa/xem màu sắc -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <span *ngIf="isViewMode">Xem màu</span>
          <span *ngIf="isEditMode">Chỉnh sửa màu</span>
          <span *ngIf="!isViewMode && !isEditMode">Thêm màu mới</span>
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group mb-3">
            <label>Tên màu <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              [class.is-invalid]="hasFieldError('name')"
              [(ngModel)]="newColor.name"
              name="name"
              [readonly]="isViewMode"
              (blur)="markFieldTouched('name')"
            />
            <div *ngIf="hasFieldError('name')" class="invalid-feedback">
              {{ getFieldError('name') }}
            </div>
          </div>
          <div class="form-group mb-3">
            <label>Mã màu <span class="text-danger">*</span></label>
            <div class="color-input-container">
              <div class="input-group">
                <span class="input-group-text">
                  <span 
                    class="color-preview-small" 
                    [style.background-color]="newColor.code || '#000000'"
                    [title]="newColor.code || 'Màu mặc định'"
                  ></span>
                </span>
                <input
                  type="text"
                  class="form-control"
                  [class.is-invalid]="hasFieldError('code')"
                  [(ngModel)]="newColor.code"
                  name="code"
                  placeholder="#FF0000 hoặc #F00"
                  [readonly]="isViewMode"
                  (blur)="markFieldTouched('code')"
                  (input)="markFieldTouched('code')"
                />
              </div>
              <div *ngIf="hasFieldError('code')" class="invalid-feedback">
                {{ getFieldError('code') }}
              </div>
              <small class="form-text text-muted">
                Định dạng hex: #FF0000 (6 ký tự) hoặc #F00 (3 ký tự)
              </small>
            </div>
          </div>
          <div class="form-group mb-3">
            <label>Trạng thái</label>
            <select
              class="form-control"
              [(ngModel)]="newColor.status"
              name="status"
              [disabled]="isViewMode"
            >
              <option [ngValue]="true">Đang hoạt động</option>
              <option [ngValue]="false">Ngừng</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          {{ isViewMode ? 'Đóng' : 'Hủy' }}
        </button>
        <button *ngIf="!isViewMode" type="button" class="btn btn-primary" (click)="save()">
          {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal xác nhận xóa -->
<div
  class="modal fade"
  [class.show]="showDeleteModal"
  [style.display]="showDeleteModal ? 'block' : 'none'"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Xác nhận xóa</h5>
        <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        <p>
          Bạn có chắc chắn muốn xóa màu
          <strong>{{ colorToDelete?.name }}</strong> không?
        </p>
        <p class="text-danger">Hành động này không thể hoàn tác!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Hủy</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay -->
<div *ngIf="showModal || showDeleteModal" class="modal-backdrop fade show"></div>
