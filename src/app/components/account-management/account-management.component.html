<div class="account-page">
  <div class="page-header">
    <h1><i class="bi bi-people"></i> Quản lý tài khoản</h1>
    <p>Quản lý người dùng, vai trò và trạng thái hoạt động</p>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="search-box">
      <i class="bi bi-search"></i>
      <input
        type="text"
        placeholder="Tìm theo tên hoặc email"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
      />
    </div>
    <div class="filters">
      <select [(ngModel)]="selectedRole" (change)="onRoleChange()">
        <option value="all">Tất cả vai trò</option>
        <option>Admin</option>
        <option>Nhân viên</option>
        <option>Quản lý kho</option>
        <option>Kế toán</option>
      </select>
      <select [(ngModel)]="selectedStatus" (change)="onStatusChange()">
        <option value="all">Tất cả trạng thái</option>
        <option>Hoạt động</option>
        <option>Khóa</option>
      </select>
      <button class="btn btn-primary" (click)="openAddModal()">
        <i class="bi bi-plus-lg"></i>
        Thêm tài khoản
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Họ tên</th>
          <th>Email</th>
          <th>Vai trò</th>
          <th>Trạng thái</th>
          <th>Ngày tạo</th>
          <th>Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of filteredUsers; let i = index">
          <td>{{ u.id }}</td>
          <td>{{ u.name }}</td>
          <td>{{ u.email }}</td>
          <td>
            <span class="role-badge" [ngClass]="getRoleBadgeClass(u.role)">{{ u.role }}</span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(u.status)">{{ u.status }}</span>
          </td>
          <td>{{ u.createdAt | date : 'dd/MM/yyyy' }}</td>
          <td class="actions">
            <button class="action-btn view" (click)="viewUser(u)" title="Xem chi tiết">
              <i class="bi bi-eye"></i>
            </button>
            <button class="action-btn edit" (click)="openEditModal(u)" title="Sửa">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="action-btn danger" (click)="deleteUser(u)" title="Xóa">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="7" class="no-data">
            <i class="bi bi-inbox"></i> Không có tài khoản phù hợp
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="bi bi-person-badge"></i>
          {{
            isViewMode ? 'Xem chi tiết tài khoản' : isEditMode ? 'Sửa tài khoản' : 'Thêm tài khoản'
          }}
        </h3>
        <button class="close-btn" (click)="closeModal()"><i class="bi bi-x"></i></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveUser()">
          <div class="form-row">
            <div class="form-group">
              <label>Họ tên *</label>
              <input
                type="text"
                [(ngModel)]="newUser.name"
                name="name"
                required
                [disabled]="isViewMode"
              />
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input
                type="email"
                [(ngModel)]="newUser.email"
                name="email"
                required
                [disabled]="isViewMode"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Vai trò *</label>
              <select [(ngModel)]="newUser.role" name="role" required [disabled]="isViewMode">
                <option>Admin</option>
                <option>Nhân viên</option>
                <option>Quản lý kho</option>
                <option>Kế toán</option>
              </select>
            </div>
            <div class="form-group">
              <label>Trạng thái *</label>
              <select [(ngModel)]="newUser.status" name="status" required [disabled]="isViewMode">
                <option>Hoạt động</option>
                <option>Khóa</option>
              </select>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              {{ isViewMode ? 'Đóng' : 'Hủy' }}
            </button>
            <button type="submit" class="btn btn-primary" *ngIf="!isViewMode">
              <i class="bi bi-check"></i> {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

