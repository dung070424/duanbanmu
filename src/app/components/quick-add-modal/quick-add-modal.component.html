<div
  class="modal fade"
  [class.show]="show"
  [style.display]="show ? 'block' : 'none'"
  tabindex="-1"
  aria-labelledby="quickAddModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="quickAddModalLabel">{{ modalTitle }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="onSave()">
          <div class="mb-3" *ngFor="let field of fields">
            <label [for]="field.name" class="form-label"
              >{{ field.label }} <span *ngIf="field.required" class="text-danger">*</span></label
            >
            <ng-container [ngSwitch]="field.type">
              <div *ngIf="type === 'mauSac' && field.name === 'maMau'" class="color-input-container">
                <div class="input-group">
                  <span class="input-group-text">
                    <span 
                      class="color-preview-small" 
                      [style.background-color]="form.maMau || '#000000'"
                      [title]="form.maMau || 'Màu mặc định'"
                    ></span>
                  </span>
                  <input
                    type="text"
                    class="form-control"
                    [class.is-invalid]="hasFieldError(field.name)"
                    [id]="field.name"
                    [(ngModel)]="form[field.name]"
                    [name]="field.name"
                    placeholder="#FF0000 hoặc #F00"
                    (blur)="markFieldTouched(field.name)"
                    (input)="markFieldTouched(field.name)"
                  />
                </div>
                <small class="form-text text-muted">
                  Định dạng hex: #FF0000 (6 ký tự) hoặc #F00 (3 ký tự)
                </small>
              </div>
              <ng-container *ngSwitchCase="'text'">
                <input
                  *ngIf="!(type === 'mauSac' && field.name === 'maMau')"
                  type="text"
                  class="form-control"
                  [class.is-invalid]="hasFieldError(field.name)"
                  [id]="field.name"
                  [(ngModel)]="form[field.name]"
                  [name]="field.name"
                  [placeholder]="'Nhập ' + field.label.toLowerCase()"
                  [required]="field.required || false"
                  (blur)="markFieldTouched(field.name)"
                />
              </ng-container>
              <input
                *ngSwitchCase="'number'"
                type="number"
                class="form-control"
                [class.is-invalid]="hasFieldError(field.name)"
                [id]="field.name"
                [(ngModel)]="form[field.name]"
                [name]="field.name"
                [placeholder]="'Nhập ' + field.label.toLowerCase()"
                [required]="field.required || false"
                (blur)="markFieldTouched(field.name)"
              />
              <textarea
                *ngSwitchCase="'textarea'"
                class="form-control"
                [class.is-invalid]="hasFieldError(field.name)"
                [id]="field.name"
                [(ngModel)]="form[field.name]"
                [name]="field.name"
                rows="3"
                [placeholder]="'Nhập ' + field.label.toLowerCase() + ' (tùy chọn)'"
                (blur)="markFieldTouched(field.name)"
              ></textarea>
              <select
                *ngSwitchCase="'select'"
                class="form-select"
                [class.is-invalid]="hasFieldError(field.name)"
                [id]="field.name"
                [(ngModel)]="form[field.name]"
                [name]="field.name"
                [required]="field.required || false"
                (change)="markFieldTouched(field.name)"
              >
                <option *ngFor="let option of field.options" [ngValue]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </ng-container>
            <!-- Single error message for each field -->
            <div *ngIf="hasFieldError(field.name)" class="invalid-feedback">
              {{ getFieldError(field.name) }}
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Hủy</button>
        <button type="submit" class="btn btn-primary" (click)="onSave()">Thêm mới</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal backdrop -->
<div
  class="modal-backdrop fade"
  [class.show]="show"
  [style.display]="show ? 'block' : 'none'"
  style="z-index: 1070"
></div>
