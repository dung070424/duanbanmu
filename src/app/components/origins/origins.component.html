<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Xuất xứ</h2>
    <button class="btn btn-primary" (click)="openAddModal()">
      <i class="bi bi-plus-circle me-1"></i>Thêm mới
    </button>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-6">
      <input
        class="form-control"
        placeholder="Tìm theo tên, mô tả"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
      />
    </div>
    <div class="col-md-3">
      <select class="form-select" [(ngModel)]="selectedStatus" (change)="onStatusChange()">
        <option value="all">Tất cả</option>
        <option value="active">Đang dùng</option>
        <option value="inactive">Ngừng dùng</option>
      </select>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th (click)="setSort('tenXuatXu')" style="cursor: pointer">Tên xuất xứ</th>
          <th (click)="setSort('moTa')" style="cursor: pointer">Mô tả</th>
          <th (click)="setSort('trangThai')" style="cursor: pointer">Trạng thái</th>
          <th>Thao tác</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let x of display; trackBy: trackById">
          <td>{{ x.tenXuatXu }}</td>
          <td class="text-truncate" style="max-width: 320px">{{ x.moTa || '-' }}</td>
          <td>
            <span class="badge" [class]="x.trangThai ? 'bg-success' : 'bg-secondary'">{{
              x.trangThai ? 'Đang dùng' : 'Ngừng dùng'
            }}</span>
          </td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-info" (click)="viewItem(x)" title="Xem">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-warning" (click)="openEditModal(x)" title="Sửa">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="delete(x)" title="Xóa">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between align-items-center my-3">
    <div>
      <button
        class="btn btn-outline-secondary btn-sm me-2"
        (click)="prevPage()"
        [disabled]="page === 0"
      >
        Trang trước
      </button>
      <button
        class="btn btn-outline-secondary btn-sm"
        (click)="nextPage()"
        [disabled]="page + 1 >= totalPages"
      >
        Trang sau
      </button>
    </div>
    <div>
      <span class="me-3">Trang {{ page + 1 }}/{{ totalPages || 1 }}</span>
      <select
        class="form-select form-select-sm d-inline-block"
        style="width: auto"
        [(ngModel)]="size"
        (ngModelChange)="changePageSize($event)"
      >
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
      </select>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            {{ isViewMode ? 'Xem' : isEditMode ? 'Sửa' : 'Thêm' }} xuất xứ
          </h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Tên xuất xứ</label>
            <input class="form-control" [(ngModel)]="form.tenXuatXu" [readonly]="isViewMode" />
          </div>
          <div class="mb-3">
            <label class="form-label">Mô tả</label>
            <textarea
              class="form-control"
              rows="3"
              [(ngModel)]="form.moTa"
              [readonly]="isViewMode"
            ></textarea>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="form.trangThai"
              [disabled]="isViewMode"
            />
            <label class="form-check-label">Đang dùng</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">
            {{ isViewMode ? 'Đóng' : 'Hủy' }}
          </button>
          <button *ngIf="!isViewMode" class="btn btn-primary" (click)="save()">
            {{ isEditMode ? 'Cập nhật' : 'Thêm mới' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div
    class="modal fade"
    [class.show]="showDeleteModal"
    [style.display]="showDeleteModal ? 'block' : 'none'"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Xác nhận xóa</h5>
          <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
        </div>
        <div class="modal-body">
          Bạn có chắc chắn muốn xóa <strong>{{ toDelete?.tenXuatXu }}</strong
          >?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Hủy</button>
          <button type="button" class="btn btn-danger" (click)="confirmDelete()">Xóa</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="showModal || showDeleteModal" class="modal-backdrop fade show"></div>
</div>
