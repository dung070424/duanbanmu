<div class="container">
  
  <!-- Filter Section -->
  <div class="filter-section">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="title-section">
          <div class="icon">
            üìã
          </div>
          <div>
            <h2 class="title">Qu·∫£n l√Ω kh√°ch h√†ng</h2>
            <div class="subtitle">
              Qu·∫£n l√Ω h·ªì s∆° kh√°ch h√†ng, ƒë·ªãa ch·ªâ v√† tr·∫°ng th√°i ho·∫°t ƒë·ªông
            </div>
          </div>
        </div>
        
        <div class="actions">
          <button (click)="openAddModal()" class="btn add">
            <span style="font-size: 16px;">+</span> Th√™m kh√°ch h√†ng
          </button>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="filter-content">
        <!-- Search -->
        <div class="search-input">
          <input [(ngModel)]="searchTerm" 
                 (input)="applyFilters()" 
                 placeholder="üîç T√¨m ki·∫øm theo t√™n, email, s·ªë ƒëi·ªán tho·∫°i, m√£ kh√°ch h√†ng...">
        </div>
        
        <!-- Status Filter -->
        <div class="status-filter">
          <span class="label">Tr·∫°ng th√°i:</span>
          <label class="radio-group">
            <input type="radio" [(ngModel)]="statusFilter" value="all" (change)="applyFilters()">
            T·∫•t c·∫£
          </label>
          <label class="radio-group">
            <input type="radio" [(ngModel)]="statusFilter" value="active" (change)="applyFilters()">
            Ho·∫°t ƒë·ªông
          </label>
          <label class="radio-group">
            <input type="radio" [(ngModel)]="statusFilter" value="inactive" (change)="applyFilters()">
            Kh√¥ng ho·∫°t ƒë·ªông
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Customer List -->
  <div class="customer-list">
    <!-- Table Header -->
    <div class="table-header">
      <div class="header-grid">
        <div>M√£ kh√°ch h√†ng</div>
        <div (click)="sortCustomers('ho_ten')" class="sortable-header">
          H·ªç t√™n {{ getSortIcon('ho_ten') }}
        </div>
        <div (click)="sortCustomers('email')" class="sortable-header">
          Email {{ getSortIcon('email') }}
        </div>
        <div (click)="sortCustomers('so_dien_thoai')" class="sortable-header">
          ƒêi·ªán tho·∫°i {{ getSortIcon('so_dien_thoai') }}
        </div>
        <div>ƒê·ªãa ch·ªâ</div>
        <div (click)="sortCustomers('diem_tich_luy')" class="sortable-header">
          ƒêi·ªÉm t√≠ch l≈©y {{ getSortIcon('diem_tich_luy') }}
        </div>
        <div (click)="sortCustomers('ngay_tao')" class="sortable-header">
          Ng√†y t·∫°o {{ getSortIcon('ngay_tao') }}
        </div>
        <div (click)="sortCustomers('trang_thai')" class="sortable-header">
          Tr·∫°ng th√°i {{ getSortIcon('trang_thai') }}
        </div>
        <div>Thao t√°c</div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <div class="icon">‚ö†Ô∏è</div>
      <h3 class="title">C√≥ l·ªói x·∫£y ra</h3>
      <p class="subtitle">{{ error }}</p>
      <button (click)="loadCustomers()" class="retry-btn">Th·ª≠ l·∫°i</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!error && paginatedCustomers.length === 0" class="empty-state">
      <div class="icon">üë•</div>
      <h3 class="title">Kh√¥ng c√≥ kh√°ch h√†ng n√†o</h3>
      <p class="subtitle">H√£y th√™m kh√°ch h√†ng ƒë·∫ßu ti√™n</p>
    </div>

    <div class="customer-list-container">
      <div *ngFor="let customer of paginatedCustomers; let i = index" 
           class="customer-row">
      
      <div class="customer-code">{{ getCustomerCode(customer) }}</div>
      <div class="customer-name">{{ customer.ho_ten || customer.name }}</div>
      <div class="email">{{ customer.email }}</div>
      <div class="phone">{{ customer.so_dien_thoai || customer.phone }}</div>
      <div class="address">{{ getCustomerAddress(customer) }}</div>
      <div class="points">{{ customer.diem_tich_luy || customer.diemTichLuy || 0 }}</div>
      <div class="date">{{ formatDate(customer.ngay_tao || customer.registrationDate) }}</div>
      <div>
        <span [class]="'status-badge ' + (getCustomerStatus(customer) === 'Active' ? 'active' : 'inactive')">
          {{ getCustomerStatus(customer) === 'Active' ? 'Ho·∫°t ƒë·ªông' : 'Kh√¥ng ho·∫°t ƒë·ªông' }}
        </span>
      </div>
      <div class="actions">
        <button (click)="viewCustomer(customer)" class="view" title="Xem chi ti·∫øt">
          <span class="action-icon">üëÅÔ∏è</span>
        </button>
        <button (click)="openEditModal(customer)" class="edit" title="Ch·ªânh s·ª≠a">
          <span class="action-icon">‚úèÔ∏è</span>
        </button>
        <button (click)="toggleCustomerStatus(customer)" 
                [class]="'toggle-status ' + (getCustomerStatus(customer) === 'Active' ? 'active' : 'inactive')"
                [title]="getCustomerStatus(customer) === 'Active' ? 'T·∫Øt ho·∫°t ƒë·ªông' : 'B·∫≠t ho·∫°t ƒë·ªông'">
          <span class="toggle-icon">
            {{ getCustomerStatus(customer) === 'Active' ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' }}
          </span>
        </button>
        <button (click)="deleteCustomer(customer)" class="delete" title="X√≥a kh√°ch h√†ng">
          <span class="action-icon">üóëÔ∏è</span>
        </button>
      </div>
    </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <!-- Items per page -->
    <div class="items-per-page">
      <span class="label">Hi·ªÉn th·ªã:</span>
      <select [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()" class="page-select">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
      <span class="label">m·ª•c m·ªói trang</span>
    </div>

    <!-- Page info -->
    <div class="page-info">
      <span>Hi·ªÉn th·ªã {{ getStartItem() }} - {{ getEndItem() }} trong t·ªïng s·ªë {{ filteredCustomers.length }} m·ª•c</span>
    </div>

    <!-- Page navigation -->
    <div class="page-navigation">
      <button (click)="goToFirstPage()" [disabled]="currentPage === 1" class="nav-btn first" title="Trang ƒë·∫ßu">
        ¬´
      </button>
      <button (click)="previousPage()" [disabled]="currentPage === 1" class="nav-btn prev" title="Trang tr∆∞·ªõc">
        <
      </button>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="nav-btn next" title="Trang sau">
        >
      </button>
      <button (click)="goToLastPage()" [disabled]="currentPage === totalPages" class="nav-btn last" title="Trang cu·ªëi">
        ¬ª
      </button>
    </div>
  </div>

  <!-- Add/Edit Customer Modal -->
  <div *ngIf="showAddModal || showEditModal" 
       class="modal-overlay"
       (click)="closeModals()">
    <div class="modal-content"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="modal-header">
        <div class="header-content">
          <h2 class="title">
            {{ showEditModal ? 'Ch·ªânh s·ª≠a kh√°ch h√†ng' : 'Th√™m Kh√°ch H√†ng' }}
          </h2>
          <button (click)="closeModals()" class="close-btn">
            √ó
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <div class="modal-body">
        <!-- Customer Form -->
        <form (ngSubmit)="saveCustomer()">
          <div class="form-grid">
            <!-- Left Column -->
            <div>
              <!-- Customer Name -->
              <div class="form-group">
                <label>T√™n kh√°ch h√†ng *</label>
                <div class="input-container">
                  <input [(ngModel)]="customerForm.ho_ten" 
                         name="ho_ten" 
                         required 
                         placeholder="Nh·∫≠p t√™n kh√°ch h√†ng"
                         [class.error]="customerErrors.ho_ten"
                         (input)="clearError('ho_ten')">
                  <span *ngIf="customerErrors.ho_ten" class="error-icon">‚ö†Ô∏è</span>
                </div>
                <div *ngIf="customerErrors.ho_ten" class="error-message">
                  {{ customerErrors.ho_ten }}
                </div>
              </div>

              <!-- Email -->
              <div class="form-group">
                <label>Email *</label>
                <div class="input-container">
                  <input [(ngModel)]="customerForm.email" 
                         name="email" 
                         type="email" 
                         required 
                         placeholder="Nh·∫≠p email"
                         [class.error]="customerErrors.email"
                         (input)="clearError('email')">
                  <span *ngIf="customerErrors.email" class="error-icon">‚ö†Ô∏è</span>
                </div>
                <div *ngIf="customerErrors.email" class="error-message">
                  {{ customerErrors.email }}
                </div>
              </div>

              <!-- Gender -->
              <div class="form-group">
                <label>Gi·ªõi t√≠nh *</label>
                <div class="radio-group">
                  <label>
                    <input type="radio" 
                           [(ngModel)]="customerForm.gioi_tinh" 
                           name="gioi_tinh" 
                           [value]="true" 
                           required>
                    Nam
                  </label>
                  <label>
                    <input type="radio" 
                           [(ngModel)]="customerForm.gioi_tinh" 
                           name="gioi_tinh" 
                           [value]="false" 
                           required>
                    N·ªØ
                  </label>
                </div>
              </div>
            </div>

            <!-- Right Column -->
            <div>
              <!-- Phone -->
              <div class="form-group">
                <label>S·ªë ƒëi·ªán tho·∫°i *</label>
                <div class="input-container">
                  <input [(ngModel)]="customerForm.so_dien_thoai" 
                         name="so_dien_thoai" 
                         required 
                         placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                         [class.error]="customerErrors.so_dien_thoai"
                         (input)="clearError('so_dien_thoai')">
                  <span *ngIf="customerErrors.so_dien_thoai" class="error-icon">‚ö†Ô∏è</span>
                </div>
                <div *ngIf="customerErrors.so_dien_thoai" class="error-message">
                  {{ customerErrors.so_dien_thoai }}
                </div>
              </div>

              <!-- Date of Birth -->
              <div class="form-group">
                <label>Ng√†y sinh *</label>
                <div class="input-container">
                  <input [value]="formatDateForInput(customerForm.ngay_sinh)" 
                         (input)="onDateChange($event); clearError('ngay_sinh')"
                         name="ngay_sinh" 
                         type="date" 
                         required
                         [class.error]="customerErrors.ngay_sinh">
                  <span *ngIf="customerErrors.ngay_sinh" class="error-icon">‚ö†Ô∏è</span>
                </div>
                <div *ngIf="customerErrors.ngay_sinh" class="error-message">
                  {{ customerErrors.ngay_sinh }}
                </div>
              </div>

              <!-- Address -->
              <div class="form-group">
                <label>ƒê·ªãa ch·ªâ</label>
                <input [(ngModel)]="customerForm.address" 
                       name="address" 
                       placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="form-group">
            <label>Ghi ch√∫</label>
            <textarea [(ngModel)]="customerForm.notes" 
                      name="notes" 
                      placeholder="Nh·∫≠p ghi ch√∫ (t√πy ch·ªçn)"
                      rows="3"></textarea>
          </div>
        </form>

        <!-- Address Management Section -->
        <div class="address-section">
          <!-- Address Header -->
          <div class="section-header">
            <div class="section-title">
              <div class="icon">
                üìç
              </div>
              <div>
                <h3 class="title">Qu·∫£n l√Ω ƒë·ªãa ch·ªâ</h3>
                <div class="badge">
                  {{ addresses.length }} ƒë·ªãa ch·ªâ
                </div>
              </div>
            </div>
            
            <div class="address-actions">
              <button (click)="showAddressDetails()" class="btn info">
                üìã Xem chi ti·∫øt
              </button>
              <button (click)="openAddressAddModal()" class="add-btn">
                <span style="font-size: 14px;">+</span> Th√™m ƒë·ªãa ch·ªâ
              </button>
            </div>
          </div>

          <!-- Address Navigation -->
          <div *ngIf="addresses.length > 0" class="address-navigation">
            <div class="nav-content">
              <button (click)="previousAddress()" 
                      [disabled]="currentAddressIndex === 0"
                      class="nav-btn prev">
                < Tr∆∞·ªõc
              </button>
              
              <div class="nav-info">
                ƒê·ªãa ch·ªâ {{ currentAddressIndex + 1 }}/{{ addresses.length }}
              </div>
              
              <button (click)="nextAddress()" 
                      [disabled]="currentAddressIndex === addresses.length - 1"
                      class="nav-btn next">
                Ti·∫øp >
              </button>
            </div>
          </div>

          <!-- Address Display -->
          <div *ngIf="addresses.length === 0" class="empty-state">
            <div class="icon">üìç</div>
            <h4 class="title">Ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o</h4>
            <p class="subtitle">H√£y th√™m ƒë·ªãa ch·ªâ ƒë·∫ßu ti√™n</p>
          </div>

          <div *ngIf="addresses.length > 0" class="address-display">
            <div *ngFor="let address of addresses; let i = index" 
                 [style.display]="i === currentAddressIndex ? 'block' : 'none'"
                 class="address-item">
              
              <!-- Default Badge -->
              <div *ngIf="getAddressDefault(address)" class="default-badge">
                ‚≠ê M·∫∑c ƒë·ªãnh
              </div>
              
              <!-- Address Info -->
              <div class="address-info">
                <div class="title">
                  ƒê·ªãa ch·ªâ {{ i + 1 }}
                </div>
                <div class="details">
                  <div class="detail-item">
                    <span class="icon">üìç</span>
                    <span class="label">ƒê·ªãa ch·ªâ c·ª• th·ªÉ:</span>
                    <span>{{ getAddressSpecific(address) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="icon">üè¢</span>
                    <span>{{ address.ward }}, {{ address.district }}, {{ address.province }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Actions -->
              <div class="actions">
                <button (click)="setAddressAsDefault(address)" 
                        [disabled]="address.isDefault"
                        class="set-default">
                  {{ address.isDefault ? 'ƒê√£ m·∫∑c ƒë·ªãnh' : 'ƒê·∫∑t m·∫∑c ƒë·ªãnh' }}
                </button>
                <button (click)="openAddressEditModal(address)" class="edit">
                  ‚úèÔ∏è S·ª≠a
                </button>
                <button (click)="deleteAddress(address)" class="delete" title="X√≥a ƒë·ªãa ch·ªâ">
                  üóëÔ∏è X√≥a
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Action Buttons -->
        <div class="modal-actions">
          <button (click)="closeModals()" class="cancel">
            H·ªßy b·ªè
          </button>
          <button (click)="saveCustomer()" class="save">
            üíæ L∆∞u kh√°ch h√†ng
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Address Add/Edit Modal -->
  <div *ngIf="showAddressAddModal || showAddressEditModal" 
       class="modal-overlay"
       (click)="closeAddressModals()">
    <div class="modal-content address-modal"
         (click)="$event.stopPropagation()">
      
      <!-- Modal Header -->
      <div class="modal-header">
        <div class="header-content">
          <h2 class="title">
            {{ showAddressEditModal ? 'Ch·ªânh s·ª≠a ƒë·ªãa ch·ªâ' : 'Th√™m ƒë·ªãa ch·ªâ m·ªõi' }}
          </h2>
          <button (click)="closeAddressModals()" class="close-btn">
            √ó
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <div class="modal-body">
        <form (ngSubmit)="saveAddress()">
          <!-- Specific Address -->
          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ c·ª• th·ªÉ *</label>
            <input [(ngModel)]="addressForm.specificAddress" 
                   name="specificAddress" 
                   required 
                   placeholder="Nh·∫≠p s·ªë nh√†, t√™n ƒë∆∞·ªùng...">
          </div>

          <!-- Province -->
          <div class="form-group">
            <label>T·ªânh/Th√†nh ph·ªë *</label>
            <select [(ngModel)]="addressForm.province" 
                    name="province" 
                    required 
                    (change)="onProvinceChange()">
              <option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>
              <option *ngFor="let province of provinces" [value]="province.id">
                {{ province.name }}
              </option>
            </select>
          </div>

          <!-- District -->
          <div class="form-group">
            <label>Qu·∫≠n/Huy·ªán *</label>
            <select [(ngModel)]="addressForm.district" 
                    name="district" 
                    required 
                    (change)="onDistrictChange()"
                    [disabled]="!addressForm.province">
              <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
              <option *ngFor="let district of filteredDistricts" [value]="district.id">
                {{ district.name }}
              </option>
            </select>
          </div>

          <!-- Ward -->
          <div class="form-group">
            <label>Ph∆∞·ªùng/X√£ *</label>
            <select [(ngModel)]="addressForm.ward" 
                    name="ward" 
                    required
                    [disabled]="!addressForm.district">
              <option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>
              <option *ngFor="let ward of filteredWards" [value]="ward.id">
                {{ ward.name }}
              </option>
            </select>
          </div>

          <!-- Default Address -->
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" 
                     [(ngModel)]="addressForm.isDefault" 
                     name="isDefault">
              <span>ƒê·∫∑t l√†m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh</span>
            </label>
          </div>
        </form>

        <!-- Modal Action Buttons -->
        <div class="modal-actions">
          <button (click)="closeAddressModals()" class="cancel">
            H·ªßy b·ªè
          </button>
          <button (click)="saveAddress()" class="save">
            üíæ {{ showAddressEditModal ? 'C·∫≠p nh·∫≠t' : 'Th√™m' }} ƒë·ªãa ch·ªâ
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Sorting Info -->
  <div class="sorting-info" *ngIf="sortField">
    <span class="sort-label">S·∫Øp x·∫øp theo:</span>
    <span class="sort-field">{{ getFieldDisplayName(sortField) }}</span>
    <span class="sort-direction">{{ sortDirection === 'asc' ? 'A ‚Üí Z' : 'Z ‚Üí A' }}</span>
    <button (click)="resetSorting()" class="reset-sort-btn">Reset</button>
  </div>
</div>

