<div class="phieu-giam-gia-container">
  <!-- Header -->
  <div class="header">
    <div class="breadcrumb">
      <span>Trang ch·ªß</span>
      <span class="separator">/</span>
      <span>Phi·∫øu gi·∫£m gi√°</span>
      <span class="separator">/</span>
      <span class="current">Form phi·∫øu gi·∫£m gi√°</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Left Section: Th√™m Phi·∫øu Gi·∫£m Gi√° -->
    <div class="left-section">
      <div class="section-header">
        <h3>Th√™m Phi·∫øu Gi·∫£m Gi√°</h3>
      </div>
      
      <div class="form-container">
        <!-- M√£ Phi·∫øu -->
        <div class="form-group">
          <label for="phieuCode">M√£ Phi·∫øu</label>
          <div class="code-input-container">
            <input 
              type="text" 
              id="phieuCode"
              [(ngModel)]="phieuCode" 
              class="form-control"
              placeholder="Nh·∫≠p m√£ phi·∫øu ho·∫∑c ch·ªçn t·ª´ g·ª£i √Ω"
              (focus)="onCodeInputFocus()"
              (blur)="onCodeInputBlur()">
            <button 
              type="button" 
              class="btn-suggestions"
              (click)="toggleSuggestions()"
              title="Xem g·ª£i √Ω m√£ phi·∫øu">
              <i class="bi bi-lightbulb"></i>
            </button>
            <button 
              type="button" 
              class="btn-refresh"
              (click)="generateNewSuggestions()"
              title="T·∫°o m√£ m·ªõi">
              <i class="bi bi-arrow-clockwise"></i>
            </button>
          </div>
          
          <!-- Suggestions Dropdown -->
          <div class="suggestions-dropdown" *ngIf="showSuggestions">
            <div class="suggestions-header">
              <span>G·ª£i √Ω m√£ phi·∫øu:</span>
              <button 
                type="button" 
                class="btn-close-suggestions"
                (click)="showSuggestions = false">
                <i class="bi bi-x"></i>
              </button>
            </div>
            <div class="suggestions-list">
              <div 
                *ngFor="let code of suggestedCodes" 
                class="suggestion-item"
                (click)="selectSuggestedCode(code)">
                <span class="suggestion-code">{{ code }}</span>
                <i class="bi bi-check-circle suggestion-icon"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- T√™n -->
        <div class="form-group">
          <label for="phieuName">T√™n</label>
          <input 
            type="text" 
            id="phieuName"
            [(ngModel)]="phieuName" 
            class="form-control"
            placeholder="Nh·∫≠p t√™n phi·∫øu gi·∫£m gi√°">
        </div>

        <!-- Lo·∫°i -->
        <div class="form-group">
          <label for="phieuType">Lo·∫°i</label>
          <select 
            id="phieuType"
            [(ngModel)]="phieuType" 
            class="form-control">
            <option [value]="true">Ti·ªÅn m·∫∑t</option>
            <option [value]="false">Ph·∫ßn trƒÉm</option>
          </select>
        </div>

        <!-- S·ªë ti·ªÅn gi·∫£m t·ªëi ƒëa -->
        <div class="form-group">
          <label for="maxDiscount">S·ªë ti·ªÅn gi·∫£m t·ªëi ƒëa</label>
          <div class="input-group">
            <input 
              type="number" 
              id="maxDiscount"
              [(ngModel)]="maxDiscount" 
              class="form-control"
              placeholder="Nh·∫≠p s·ªë ti·ªÅn gi·∫£m t·ªëi ƒëa">
            <span class="input-group-text">{{ phieuType ? 'VND' : '%' }}</span>
          </div>
        </div>

        <!-- S·ªë ti·ªÅn gi·∫£m t·ªëi thi·ªÉu -->
        <div class="form-group">
          <label for="minDiscount">S·ªë ti·ªÅn gi·∫£m t·ªëi thi·ªÉu</label>
          <div class="input-group">
            <input 
              type="number" 
              id="minDiscount"
              [(ngModel)]="minDiscount" 
              class="form-control"
              placeholder="Nh·∫≠p s·ªë ti·ªÅn gi·∫£m t·ªëi thi·ªÉu"
              min="0">
            <span class="input-group-text">{{ phieuType ? 'VND' : '%' }}</span>
          </div>
        </div>

        <!-- H√≥a ƒë∆°n t·ªëi thi·ªÉu -->
        <div class="form-group">
          <label for="minInvoice">H√≥a ƒë∆°n t·ªëi thi·ªÉu</label>
          <div class="input-group">
            <input 
              type="number" 
              id="minInvoice"
              [(ngModel)]="minInvoice" 
              class="form-control"
              placeholder="Nh·∫≠p h√≥a ƒë∆°n t·ªëi thi·ªÉu">
            <span class="input-group-text">VND</span>
          </div>
        </div>

        <!-- S·ªë l∆∞·ª£ng -->
        <div class="form-group">
          <label for="quantity">S·ªë l∆∞·ª£ng</label>
          <input 
            type="number" 
            id="quantity"
            [(ngModel)]="quantity" 
            class="form-control"
            placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng">
        </div>

        <!-- Tr·∫°ng th√°i -->
        <div class="form-group">
          <label for="trangThai">Tr·∫°ng th√°i</label>
          <select 
            id="trangThai"
            [(ngModel)]="trangThai" 
            class="form-control">
            <option [ngValue]="true">Ho·∫°t ƒë·ªông</option>
            <option [ngValue]="false">Kh√¥ng ho·∫°t ƒë·ªông</option>
          </select>
        </div>

        <!-- Ng√†y b·∫Øt ƒë·∫ßu -->
        <div class="form-group">
          <label for="startDate">Ng√†y b·∫Øt ƒë·∫ßu</label>
          <input 
            type="date" 
            id="startDate"
            [(ngModel)]="startDate" 
            class="form-control">
        </div>

        <!-- Ng√†y k·∫øt th√∫c -->
        <div class="form-group">
          <label for="endDate">Ng√†y k·∫øt th√∫c</label>
          <input 
            type="date" 
            id="endDate"
            [(ngModel)]="endDate" 
            class="form-control">
        </div>
      </div>
    </div>

    <!-- Right Section: Ch·ªçn Kh√°ch H√†ng -->
    <div class="right-section">
      <div class="section-header">
        <h3>Ch·ªçn Kh√°ch H√†ng</h3>
      </div>

      <!-- Search -->
      <div class="search-container">
        <div class="search-box">
          <i class="search-icon">üîç</i>
          <input 
            type="text" 
            [(ngModel)]="searchTerm"
            (input)="filterCustomers()"
            class="search-input"
            placeholder="T√¨m theo m√£ ho·∫∑c t√™n...">
        </div>
        <button class="btn-all">T·∫•t c·∫£</button>
      </div>

      <!-- Customer List -->
      <div class="customer-list-container">
        <div class="table-container">
          <table class="customer-table">
            <thead>
              <tr>
                <th>M√£ KH</th>
                <th>T√™n Kh√°ch H√†ng</th>
                <th>Gi·ªõi t√≠nh</th>
                <th>Ng√†y sinh</th>
                <th>T·ªïng s·ªë l·∫ßn mua</th>
                <th>L·∫ßn mua g·∫ßn nh·∫•t</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let customer of filteredCustomers" class="customer-row">
                <td>{{ customer.maKhachHang }}</td>
                <td>{{ customer.tenKhachHang }}</td>
                <td>{{ getGenderText(customer.gioiTinh) }}</td>
                <td>{{ customer.ngaySinh }}</td>
                <td>{{ customer.tongSoLanMua }}</td>
                <td>{{ customer.lanMuaGanNhat }}</td>
                <td>
                  <button 
                    class="btn-select"
                    (click)="selectCustomer(customer)"
                    [disabled]="isCustomerSelected(customer)">
                    {{ isCustomerSelected(customer) ? 'ƒê√£ ch·ªçn' : 'Ch·ªçn' }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Selected Customers -->
      <div class="selected-customers-container">
        <h4>Kh√°ch H√†ng ƒê√£ Ch·ªçn</h4>
        <div class="selected-table-container">
          <table class="selected-table">
            <thead>
              <tr>
                <th>M√£ KH</th>
                <th>T√™n Kh√°ch H√†ng</th>
                <th>Gi·ªõi t√≠nh</th>
                <th>Ng√†y sinh</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let customer of selectedCustomers" class="selected-row">
                <td>{{ customer.maKhachHang }}</td>
                <td>{{ customer.tenKhachHang }}</td>
                <td>{{ getGenderText(customer.gioiTinh) }}</td>
                <td>{{ customer.ngaySinh }}</td>
                <td>
                  <button 
                    class="btn-remove"
                    (click)="removeCustomer(customer)">
                    X√≥a
                  </button>
                </td>
              </tr>
              <tr *ngIf="selectedCustomers.length === 0">
                <td colspan="5" class="no-selection">
                  Ch∆∞a c√≥ kh√°ch h√†ng n√†o ƒë∆∞·ª£c ch·ªçn
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button 
      class="btn-save"
      (click)="savePhieuGiamGia()"
      [disabled]="isSaving">
      {{ isSaving ? 'ƒêang l∆∞u...' : 'L∆∞u Phi·∫øu Gi·∫£m Gi√°' }}
    </button>
    <button 
      class="btn-cancel"
      (click)="goBack()">
      H·ªßy
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>
  
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>
</div>
